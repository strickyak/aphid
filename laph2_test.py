from . import laph2 as L

p1 = `{ a = {
  x = 5
  y = 10
} }`
l1 = L.Lex(p1)
say l1.toks
assert l1.toks ==  [
    ("{", 1), ("a", 1), ("=", 1), ("{", 1), (";", 1),
    ("x", 2), ("=", 2), ("5", 2), (";", 2),
    ("y", 3), ("=", 3), ("10", 3), (";", 3),
    ("}", 4), ("}", 4), (";", 4)
    ]


prog3 = `{
  a = {
    b = { x = 100 ; y = 200 ; c = 5 }
    bb = { x = 111 ; c = 555 }
  } 
  d = /a/b { c = 8 } 
  e = /a {
    p = { q = 9 } 
    b { x = 888 }
  }
}`
tree3 = L.Parse(prog3).expr()
print '#############################################################'
assert L.LazyEval(tree3).Eval('b/c', 'a') == '5'
print '#############################################################'
assert except L.LazyEval(tree3).Eval('b/c/x', 'a')
print '#############################################################'
assert ["b", "bb", "p"] == L.LazyEval(tree3).Eval('/e')
print '#############################################################'
assert ["c", "x"] == L.LazyEval(tree3).Eval('/e/bb')
print '#############################################################'
assert ["c", "x", "y"] == L.LazyEval(tree3).Eval('/e/b')
print '#############################################################'
assert "888" == L.LazyEval(tree3).Eval('/e/b/x')
print '#############################################################'
assert "100" == L.LazyEval(tree3).Eval('/a/b/x')
print '#############################################################'
assert "200" == L.LazyEval(tree3).Eval('/e/b/y')
print '#############################################################'
assert "200" == L.LazyEval(tree3).Eval('/d/y')
print '#############################################################'
assert "8" == L.LazyEval(tree3).Eval('/d/c')
